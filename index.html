<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶®‡¶ï‡¶∂‡¶æ ‡¶≤‡ßç‡¶Ø‡¶æ‡¶¨ | ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶™‡ßü‡ßá‡¶®‡ßç‡¶ü</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- SortableJS (Drag & Drop ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', 'Hind Siliguri', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0;
        }

        /* --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶á‡¶â‡¶ü‡¶ø‡¶≤‡¶ø‡¶ü‡¶ø --- */
        .glass-effect {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #818cf8 0%, #c084fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* ‡¶°‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ó ‡¶è‡¶¨‡¶Ç ‡¶°‡ßç‡¶∞‡¶™ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        .sortable-ghost {
            opacity: 0.4;
            background-color: #334155;
        }
        .sortable-drag {
            cursor: grabbing;
        }
        .cursor-grab {
            cursor: grab;
        }

        /* ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶¨‡¶æ‡¶∞ */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background-color: #475569; border-radius: 10px; }
        
        /* ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡¶ú‡¶ø‡¶∂‡¶® */
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Error Banner Animation */
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- ‡ßß. ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶≠‡¶ø‡¶â (FRONT END) -->
    <div id="customer-view" class="flex-grow fade-in hidden">
        <!-- ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® -->
        <nav class="glass-effect sticky top-0 z-50 border-b border-slate-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16 items-center">
                    <div class="flex items-center">
                        <span class="text-2xl font-bold gradient-text">‡¶®‡¶ï‡¶∂‡¶æ ‡¶≤‡ßç‡¶Ø‡¶æ‡¶¨</span>
                    </div>
                    <div class="hidden md:flex space-x-8">
                        <a href="#" class="text-gray-300 hover:text-white transition">‡¶π‡ßã‡¶Æ</a>
                        <a href="#services" class="text-gray-300 hover:text-white transition">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡¶∏‡¶Æ‡ßÇ‡¶π</a>
                        <a href="#contact" class="text-gray-300 hover:text-white transition">‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó</a>
                    </div>
                    <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶ø‡¶® ‡¶¨‡¶æ‡¶ü‡¶® (‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã ‡¶¨‡¶æ ‡¶õ‡ßã‡¶ü ‡¶ï‡¶∞‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ) -->
                    <button onclick="showLoginModal()" class="text-xs text-slate-600 hover:text-slate-400">
                        Admin
                    </button>
                </div>
            </div>
        </nav>

        <!-- ‡¶π‡¶ø‡¶∞‡ßã ‡¶∏‡ßá‡¶ï‡¶∂‡¶® -->
        <div class="relative bg-slate-900 overflow-hidden">
            <div class="max-w-7xl mx-auto py-16 px-4 sm:py-24 sm:px-6 lg:px-8 text-center">
                <h1 class="text-4xl font-extrabold tracking-tight text-white sm:text-5xl lg:text-6xl mb-4">
                    ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ <span class="gradient-text">‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®</span> ‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶á
                </h1>
                <p class="mt-4 text-xl text-slate-400 max-w-2xl mx-auto">
                    ‡¶™‡¶æ‡¶∏‡¶™‡ßã‡¶∞‡ßç‡¶ü, ‡¶≠‡¶ø‡¶∏‡¶æ, ‡¶ú‡¶®‡ßç‡¶Æ ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶¨ ‡¶ß‡¶∞‡¶£‡ßá‡¶∞ ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶Ü‡¶¨‡ßá‡¶¶‡¶® ‡¶ì ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶∏‡ßç‡¶§ ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶∑‡ßç‡¶†‡¶æ‡¶®‡•§
                </p>
            </div>
        </div>

        <!-- ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü (‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡¶∞‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶®‡¶æ‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá) -->
        <div id="services" class="max-w-7xl mx-auto px-4 py-12">
            <h2 class="text-3xl font-bold text-center text-white mb-10 border-b border-slate-800 pb-4">‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶∏‡ßá‡¶¨‡¶æ‡¶∏‡¶Æ‡ßÇ‡¶π</h2>
            
            <div id="public-service-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- ‡¶ú‡¶æ‡¶≠‡¶æ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶¶‡¶ø‡ßü‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá -->
                <div class="text-center text-slate-500 col-span-full animate-pulse">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
            </div>
        </div>

        <!-- ‡¶´‡ßÅ‡¶ü‡¶æ‡¶∞ -->
        <footer id="contact" class="bg-slate-950 border-t border-slate-800 mt-auto py-8">
            <div class="max-w-7xl mx-auto px-4 text-center text-slate-400">
                <p>‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶ú‡¶æ‡¶®‡¶§‡ßá‡•§</p>
                <p class="mt-2">&copy; ‡ß®‡ß¶‡ß®‡ß´ ‡¶®‡¶ï‡¶∂‡¶æ ‡¶≤‡ßç‡¶Ø‡¶æ‡¶¨‡•§ ‡¶∏‡¶∞‡ßç‡¶¨‡¶∏‡ßç‡¶¨‡¶§‡ßç‡¶¨ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§‡•§</p>
            </div>
        </footer>
    </div>

    <!-- ‡ß®. ‡¶≤‡¶ó‡¶ø‡¶® ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ (ADMIN GATE) -->
    <div id="auth-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 hidden backdrop-blur-sm">
        <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-md border border-slate-700">
            <h2 class="text-2xl font-bold text-white mb-6 text-center">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶≤‡¶ó‡¶ø‡¶®</h2>
            <form id="login-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-slate-400">‡¶á‡¶Æ‡ßá‡¶á‡¶≤</label>
                    <input type="email" id="admin-email" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:outline-none focus:border-indigo-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-400">‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°</label>
                    <input type="password" id="admin-password" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:outline-none focus:border-indigo-500" required>
                </div>
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </form>
            <button onclick="hideLoginModal()" class="mt-4 text-sm text-slate-500 hover:text-white w-full text-center">‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®</button>
        </div>
    </div>

    <!-- ‡ß©. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ (BACK END) -->
    <div id="admin-view" class="flex-grow fade-in hidden">
        <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶π‡ßá‡¶°‡¶æ‡¶∞ -->
        <header class="bg-slate-800 border-b border-slate-700 sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <h1 class="text-xl font-bold gradient-text">‡¶®‡¶ï‡¶∂‡¶æ ‡¶≤‡ßç‡¶Ø‡¶æ‡¶¨ (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®)</h1>
                    <span class="px-2 py-1 bg-red-500/20 text-red-400 text-xs rounded-full border border-red-500/30">‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞ ‡¶Æ‡ßã‡¶°</span>
                </div>
                <div class="flex items-center space-x-3">
                    <button onclick="toggleView('dashboard')" class="text-sm font-medium text-white hover:text-indigo-400">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°</button>
                    <div class="h-4 w-px bg-slate-600"></div>
                    <button onclick="toggleView('history')" class="text-sm font-medium text-slate-300 hover:text-indigo-400">‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø ‡¶ì ‡¶≤‡¶æ‡¶≠</button>
                    <div class="h-4 w-px bg-slate-600"></div>
                    <button onclick="logoutAdmin()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-bold transition">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 py-8">
            
            <!-- ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡ßß: ‡¶Æ‡ßá‡¶á‡¶® ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° (‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶è‡¶°‡¶ø‡¶ü) -->
            <div id="tab-dashboard" class="space-y-8">
                <!-- ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶§‡ßà‡¶∞‡¶ø -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700">
                        <h3 class="font-bold text-white mb-4">‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                        <form id="add-category-form" class="flex gap-2">
                            <input type="text" id="new-cat-name" placeholder="‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-white focus:outline-none focus:border-indigo-500">
                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 rounded-lg text-sm">‡¶Ø‡ßã‡¶ó</button>
                        </form>
                        <div id="admin-cat-list" class="mt-4 space-y-2 max-h-40 overflow-y-auto">
                            <!-- ‡¶°‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ó ‡¶è‡¶¨‡¶Ç ‡¶°‡ßç‡¶∞‡¶™ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø -->
                        </div>
                        <p class="text-xs text-slate-500 mt-2 text-center">‡¶â‡¶™‡¶∞‡ßá-‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡¶æ‡¶ú‡¶æ‡¶§‡ßá ‡¶Æ‡¶æ‡¶â‡¶∏ ‡¶¶‡¶ø‡ßü‡ßá ‡¶ü‡¶æ‡¶®‡ßÅ‡¶®</p>
                    </div>

                    <!-- ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶Ø‡ßã‡¶ó -->
                    <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 lg:col-span-2">
                        <h3 class="font-bold text-white mb-4">‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶ú ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                        <form id="add-task-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶®‡¶æ‡¶Æ -->
                            <select id="task-cat-select" class="bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-white focus:outline-none" required></select>
                            <input type="text" id="task-name" placeholder="‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ" class="bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-white focus:outline-none" required>
                            
                            <!-- ‡¶¶‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶ñ‡¶∞‡¶ö -->
                            <div class="flex gap-2 md:col-span-2">
                                <input type="number" id="task-price" placeholder="‡¶¶‡¶æ‡¶Æ (‡ß≥)" class="w-1/2 bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-white focus:outline-none" required>
                                <input type="number" id="task-expense" placeholder="‡¶ñ‡¶∞‡¶ö (‡ß≥)" class="w-1/2 bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-white focus:outline-none" required>
                            </div>

                            <!-- ‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü‡¶§‡¶æ (Textarea - ‡¶¨‡ßú ‡¶¨‡¶ï‡ßç‡¶∏) -->
                            <textarea id="task-req" placeholder="‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü‡¶§‡¶æ (‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®, ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá ‡¶®‡¶æ)" class="bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-white focus:outline-none md:col-span-2" rows="3"></textarea>
                            
                            <!-- ‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® -->
                            <button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 rounded-lg md:col-span-2">‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        </form>
                    </div>
                </div>

                <!-- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü (‡¶°‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ó‡ßá‡¶¨‡¶≤) -->
                <div id="admin-tasks-container" class="space-y-6">
                    <!-- ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶≠‡¶ø‡¶§‡ßç‡¶§‡¶ø‡¶ï ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ ‡¶∞‡ßá‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá -->
                </div>
            </div>

            <!-- ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡ß®: ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø ‡¶ì ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨ -->
            <div id="tab-history" class="hidden space-y-6">
                <div class="bg-slate-800 p-6 rounded-xl border border-slate-700 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-white">‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø</h2>
                        <p class="text-slate-400 text-sm">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ ‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶ì ‡¶≤‡¶æ‡¶≠‡ßá‡¶∞ ‡¶π‡¶ø‡¶∏‡¶æ‡¶¨</p>
                    </div>
                    <div class="text-right">
                        <p class="text-sm text-slate-400">‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶≤‡¶æ‡¶≠</p>
                        <p id="total-profit-display" class="text-3xl font-bold text-emerald-400">‡ß≥ ‡ß¶</p>
                    </div>
                </div>

                <div class="bg-slate-800 rounded-xl border border-slate-700 overflow-hidden">
                    <table class="min-w-full divide-y divide-slate-700">
                        <thead class="bg-slate-900">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-bold text-slate-400 uppercase">‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ</th>
                                <th class="px-6 py-3 text-left text-xs font-bold text-slate-400 uppercase">‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</th>
                                <th class="px-6 py-3 text-right text-xs font-bold text-slate-400 uppercase">‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø</th>
                                <th class="px-6 py-3 text-right text-xs font-bold text-slate-400 uppercase">‡¶≤‡¶æ‡¶≠</th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body" class="divide-y divide-slate-700">
                            <!-- ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø ‡¶°‡ßá‡¶ü‡¶æ -->
                        </tbody>
                    </table>
                </div>
            </div>

        </div>
    </div>

    <!-- ‡¶®‡¶§‡ßÅ‡¶®: ‡¶è‡¶∞‡¶∞ ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ -->
    <div id="error-banner" class="fixed bottom-4 right-4 max-w-sm bg-red-600 border border-red-500 text-white p-4 rounded-xl shadow-2xl hidden z-50 flex items-start space-x-3 slide-up">
        <svg class="w-6 h-6 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
        <div class="flex-1">
            <h4 class="font-bold text-sm">‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø!</h4>
            <p id="error-message" class="text-xs mt-1 text-red-100">‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡ßç‡¶•‡¶æ‡¶™‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            <button onclick="window.location.reload()" class="mt-2 bg-white text-red-600 px-3 py-1 rounded text-xs font-bold hover:bg-red-50 transition">‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
        <button onclick="document.getElementById('error-banner').classList.add('hidden')" class="ml-auto text-red-200 hover:text-white">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
    </div>

    <!-- ‡¶ï‡¶æ‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ (‡¶≤‡¶æ‡¶≠ ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶ï‡¶∞‡¶£) -->
    <div id="complete-job-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 hidden backdrop-blur-sm">
        <div class="bg-slate-800 p-6 rounded-2xl shadow-2xl w-full max-w-sm border border-slate-700">
            <h3 class="text-xl font-bold text-white mb-4">‡¶ï‡¶æ‡¶ú ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <p id="modal-task-name" class="text-slate-400 text-sm mb-4">...</p>
            <form id="complete-job-form" class="space-y-4">
                <input type="hidden" id="modal-task-id">
                <div>
                    <label class="text-xs text-slate-500">‡¶´‡¶æ‡¶á‡¶®‡¶æ‡¶≤ ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡¶ü‡¶æ‡¶ï‡¶æ)</label>
                    <input type="number" id="modal-final-price" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white">
                </div>
                <div>
                    <label class="text-xs text-slate-500">‡¶Ü‡¶∏‡¶≤ ‡¶ñ‡¶∞‡¶ö (‡¶ü‡¶æ‡¶ï‡¶æ)</label>
                    <input type="number" id="modal-final-expense" class="w-full bg-slate-900 border border-slate-700 rounded p-2 text-white">
                </div>
                <div class="flex gap-3 mt-4">
                    <button type="button" onclick="closeCompleteModal()" class="flex-1 bg-slate-700 text-white py-2 rounded">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 rounded font-bold">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ‡¶ï‡¶æ‡¶ú ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ -->
    <div id="edit-task-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 hidden backdrop-blur-sm">
        <div class="bg-slate-800 p-6 rounded-2xl shadow-2xl w-full max-w-md border border-slate-700">
            <h3 class="text-xl font-bold text-white mb-4">‡¶ï‡¶æ‡¶ú ‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
            <form id="edit-task-form" class="space-y-4">
                <input type="hidden" id="edit-modal-task-id">
                <div>
                    <label class="block text-sm font-medium text-slate-400">‡¶ï‡¶æ‡¶ú‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</label>
                    <input type="text" id="edit-task-name" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-white focus:outline-none focus:border-indigo-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-400">‡¶™‡ßç‡¶∞‡ßü‡ßã‡¶ú‡¶®‡ßÄ‡ßü‡¶§‡¶æ</label>
                    <!-- Textarea for editing Requirements -->
                    <textarea id="edit-task-req" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-white focus:outline-none focus:border-indigo-500" rows="4"></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-400">‡¶¶‡¶æ‡¶Æ (‡ß≥)</label>
                        <input type="number" id="edit-task-price" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-white focus:outline-none focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-400">‡¶ñ‡¶∞‡¶ö (‡ß≥)</label>
                        <input type="number" id="edit-task-expense" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-white focus:outline-none focus:border-indigo-500" required>
                    </div>
                </div>
                <div class="flex gap-3 mt-4">
                    <button type="button" onclick="closeEditTaskModal()" class="flex-1 bg-slate-700 text-white py-2 rounded">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded font-bold">‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDaa1NZUI498mN7Z9WWGVyzaiwmNDB_cOU",
            authDomain: "work-list-acc83.firebaseapp.com",
            projectId: "work-list-acc83",
            storageBucket: "work-list-acc83.firebasestorage.app",
            messagingSenderId: "365350979318",
            appId: "1:365350979318:web:5a3e0135a1581f89330ed7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'noksha-lab-live';

        // State
        let appData = { categories: [], tasks: [] };
        let historyData = [];
        let isAdmin = false;

        // --- DOM Elements ---
        const customerView = document.getElementById('customer-view');
        const adminView = document.getElementById('admin-view');
        const authModal = document.getElementById('auth-modal');
        const publicServiceContainer = document.getElementById('public-service-container');
        const adminTasksContainer = document.getElementById('admin-tasks-container');
        const adminCatList = document.getElementById('admin-cat-list');
        const taskCatSelect = document.getElementById('task-cat-select');
        const historyTableBody = document.getElementById('history-table-body');
        const totalProfitDisplay = document.getElementById('total-profit-display');
        const errorBanner = document.getElementById('error-banner');
        const errorMessage = document.getElementById('error-message');

        // --- Error Handling Function ---
        function showError(msg) {
            errorMessage.textContent = msg;
            errorBanner.classList.remove('hidden');
            // ‡ß´ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶™‡¶∞ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶π‡¶æ‡¶á‡¶° ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá, ‡¶§‡¶¨‡ßá ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶è‡¶∞‡¶∞ ‡¶π‡¶≤‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶ï‡ßç‡¶≤‡ßã‡¶ú ‡¶ï‡¶∞‡¶æ‡¶á ‡¶≠‡¶æ‡¶≤‡ßã
        }

        // --- Auth Setup ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü ‡¶Ü‡¶õ‡ßá (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßã‡¶®‡¶ø‡¶Æ‡¶æ‡¶∏ ‡¶¨‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®)
                
                if (!user.isAnonymous) {
                    // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®
                    isAdmin = true;
                    showAdminPanel();
                    loadHistoryData(); // ‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶ü ‡¶°‡¶æ‡¶ü‡¶æ
                } else {
                    // ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ (‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßã‡¶®‡¶ø‡¶Æ‡¶æ‡¶∏)
                    isAdmin = false;
                    showCustomerView();
                }
                
                // ‡¶™‡¶æ‡¶¨‡¶≤‡¶ø‡¶ï ‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶°
                loadPublicData(); 
            } else {
                // ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡ßá‡¶á -> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡ßã‡¶®‡¶ø‡¶Æ‡¶æ‡¶∏ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡¶æ‡¶á
                signInAnonymously(auth).catch((error) => {
                    console.error("Anonymous auth failed", error);
                    showError("‡¶Ö‡¶•‡ßá‡¶®‡ßç‡¶ü‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶™‡ßá‡¶ú‡¶ü‡¶ø ‡¶∞‡¶ø‡¶≤‡ßã‡¶° ‡¶¶‡¶ø‡¶®‡•§");
                });
            }
        });

        // --- Data Loading ---
        let unsubscribePublic = null; 

        function loadPublicData() {
            if (unsubscribePublic) {
                unsubscribePublic();
            }

            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'noksha_lab', 'main_list');
            
            unsubscribePublic = onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    appData = docSnap.data();
                    renderCustomerUI();
                    if (isAdmin) renderAdminUI();
                    // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶è‡¶∞‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶≤‡ßÅ‡¶ï‡¶ø‡ßü‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶≠‡¶æ‡¶≤‡ßã
                    errorBanner.classList.add('hidden');
                } else {
                    appData = { categories: [], tasks: [] };
                    if(isAdmin) setDoc(docRef, appData);
                }
            }, (error) => {
                console.error("Data Load Error:", error);
                showError("‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§ ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
            });
        }

        function loadHistoryData() {
            // ‡ß¨ ‡¶∏‡ßç‡¶ü‡ßá‡¶™‡ßá‡¶∞ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶™‡¶æ‡¶• ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá
            const docRef = doc(db, 'artifacts', appId, 'private', 'history', 'logs', 'sales_log');
            onSnapshot(docRef, (docSnap) => {
                if (docSnap.exists()) {
                    historyData = docSnap.data().logs || [];
                    renderHistoryUI();
                }
            }, (error) => {
                console.error("History Load Error:", error);
                if (error.code === 'permission-denied') {
                    showError("‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶è‡¶∞‡¶∞! ‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶´‡¶æ‡ßü‡¶æ‡¶∞‡¶¨‡ßá‡¶∏ ‡¶∞‡ßÅ‡¶≤‡¶∏ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
                } else {
                    showError("‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§");
                }
            });
        }

        // --- UI Rendering: Customer (Clean) ---
        function renderCustomerUI() {
            publicServiceContainer.innerHTML = '';
            
            if(appData.categories.length === 0) {
                publicServiceContainer.innerHTML = '<p class="text-center text-slate-500 col-span-full">‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§</p>';
                return;
            }

            appData.categories.forEach(cat => {
                const catTasks = appData.tasks.filter(t => t.categoryId === cat.id);
                if (catTasks.length === 0) return;

                const card = document.createElement('div');
                card.className = 'bg-slate-800 rounded-2xl border border-slate-700 p-6 hover:border-indigo-500/50 transition duration-300';
                
                let taskListHtml = catTasks.map(task => `
                    <li class="flex items-center text-slate-300 mb-2">
                        <svg class="w-4 h-4 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        ${task.name}
                    </li>
                `).join('');

                card.innerHTML = `
                    <h3 class="text-xl font-bold text-white mb-4 pb-2 border-b border-slate-700">${cat.name}</h3>
                    <ul class="space-y-1">
                        ${taskListHtml}
                    </ul>
                    <div class="mt-6 pt-4 border-t border-slate-700/50 text-center">
                        <a href="#contact" class="text-sm text-indigo-400 hover:text-indigo-300 font-medium">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶ú‡¶æ‡¶®‡¶§‡ßá ‡¶ï‡¶≤ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
                    </div>
                `;
                publicServiceContainer.appendChild(card);
            });
        }

        // --- UI Rendering: Admin (Detailed & Sortable) ---
        function renderAdminUI() {
            // ‡ßß. ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü
            adminCatList.innerHTML = appData.categories.map(cat => `
                <div class="bg-slate-700 p-2 rounded flex justify-between items-center cursor-move sortable-cat-item" data-id="${cat.id}">
                    <span class="text-sm font-bold text-white">${cat.name}</span>
                    <button onclick="window.deleteCategory('${cat.id}')" class="text-red-400 hover:text-red-300">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>
            `).join('');

            // ‡ß®. ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
            taskCatSelect.innerHTML = appData.categories.map(cat => `<option value="${cat.id}">${cat.name}</option>`).join('');

            // ‡ß©. ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü
            adminTasksContainer.innerHTML = '';
            appData.categories.forEach(cat => {
                const catTasks = appData.tasks.filter(t => t.categoryId === cat.id);
                
                const section = document.createElement('div');
                section.className = 'bg-slate-800 rounded-xl border border-slate-700 overflow-hidden';
                
                const tbodyId = `sortable-tasks-${cat.id}`;
                
                section.innerHTML = `
                    <div class="bg-slate-900 p-3 border-b border-slate-700 flex justify-between">
                        <h3 class="font-bold text-indigo-400">${cat.name}</h3>
                        <span class="text-xs text-slate-500 bg-slate-800 px-2 rounded">${catTasks.length} ‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="bg-slate-800/50 text-slate-400">
                                <tr>
                                    <th class="px-4 py-2 text-left">‡¶®‡¶æ‡¶Æ</th>
                                    <th class="px-4 py-2 text-right">‡¶ñ‡¶∞‡¶ö</th>
                                    <th class="px-4 py-2 text-right">‡¶¶‡¶æ‡¶Æ</th>
                                    <th class="px-4 py-2 text-right">‡¶≤‡¶æ‡¶≠</th>
                                    <th class="px-4 py-2 text-center">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®</th>
                                </tr>
                            </thead>
                            <tbody id="${tbodyId}" class="divide-y divide-slate-700" data-cat-id="${cat.id}">
                                ${catTasks.map(task => {
                                    const profit = task.customerPrice - task.ownerExpense;
                                    return `
                                    <tr class="hover:bg-slate-700/50 cursor-grab" data-task-id="${task.id}">
                                        <td class="px-4 py-2 text-white">
                                            <div class="font-medium">${task.name}</div>
                                            <div class="text-xs text-slate-500">${task.requirements}</div>
                                        </td>
                                        <td class="px-4 py-2 text-right text-slate-300">‡ß≥${task.ownerExpense}</td>
                                        <td class="px-4 py-2 text-right text-indigo-300 font-bold">‡ß≥${task.customerPrice}</td>
                                        <td class="px-4 py-2 text-right text-emerald-400 font-bold">‡ß≥${profit}</td>
                                        <td class="px-4 py-2 text-center space-x-2">
                                            <button onclick="window.initCompleteJob('${task.id}')" class="bg-emerald-600 hover:bg-emerald-700 text-white px-2 py-1 rounded text-xs" title="‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑ ‡¶ì ‡¶≤‡¶æ‡¶≠ ‡¶ú‡¶Æ‡¶æ">‚úì</button>
                                            <button onclick="window.openEditTaskModal('${task.id}')" class="bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded text-xs" title="‡¶è‡¶°‡¶ø‡¶ü">‚úé</button>
                                            <button onclick="window.deleteTask('${task.id}')" class="text-red-400 hover:text-red-300">üóë</button>
                                        </td>
                                    </tr>
                                    `
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
                adminTasksContainer.appendChild(section);

                new Sortable(document.getElementById(tbodyId), {
                    group: 'tasks',
                    animation: 150,
                    ghostClass: 'sortable-ghost',
                    onEnd: function (evt) {
                        handleTaskSort(evt.item.dataset.taskId, evt.to.dataset.catId);
                    }
                });
            });

            new Sortable(adminCatList, {
                animation: 150,
                ghostClass: 'sortable-ghost',
                onEnd: function (evt) {
                    // Future Category Reorder Logic
                }
            });
        }

        // --- History Logic ---
        function renderHistoryUI() {
            historyTableBody.innerHTML = '';
            let totalProfit = 0;

            const sortedLogs = [...historyData].reverse();

            sortedLogs.forEach(log => {
                totalProfit += log.profit;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="px-6 py-3 whitespace-nowrap text-slate-300">${new Date(log.date).toLocaleDateString('bn-BD')}</td>
                    <td class="px-6 py-3 text-slate-200 font-medium">${log.taskName}</td>
                    <td class="px-6 py-3 text-right text-slate-300">‡ß≥${log.price}</td>
                    <td class="px-6 py-3 text-right text-emerald-400 font-bold">+‡ß≥${log.profit}</td>
                `;
                historyTableBody.appendChild(row);
            });

            totalProfitDisplay.textContent = `‡ß≥ ${totalProfit.toLocaleString('bn-BD')}`;
        }

        // --- Complete Job Logic ---
        window.initCompleteJob = function(taskId) {
            const task = appData.tasks.find(t => t.id == taskId);
            if(!task) return;
            
            document.getElementById('modal-task-id').value = task.id;
            document.getElementById('modal-task-name').textContent = task.name;
            document.getElementById('modal-final-price').value = task.customerPrice;
            document.getElementById('modal-final-expense').value = task.ownerExpense;
            
            document.getElementById('complete-job-modal').classList.remove('hidden');
        }

        document.getElementById('complete-job-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const taskId = document.getElementById('modal-task-id').value;
            const price = parseInt(document.getElementById('modal-final-price').value);
            const expense = parseInt(document.getElementById('modal-final-expense').value);
            const taskName = document.getElementById('modal-task-name').textContent;
            
            const profit = price - expense;
            const newLog = {
                date: new Date().toISOString(),
                taskId: taskId,
                taskName: taskName,
                price: price,
                expense: expense,
                profit: profit
            };

            const docRef = doc(db, 'artifacts', appId, 'private', 'history', 'logs', 'sales_log');
            
            try {
                const docSnap = await getDoc(docRef);
                if(docSnap.exists()) {
                    await updateDoc(docRef, { logs: arrayUnion(newLog) });
                } else {
                    await setDoc(docRef, { logs: [newLog] });
                }
                alert("‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø‡¶§‡ßá ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
                window.closeCompleteModal();
            } catch(err) {
                console.error(err);
                showError("‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡¶∞‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            }
        });

        // --- Edit Task Logic ---
        window.openEditTaskModal = function(taskId) {
            const task = appData.tasks.find(t => t.id == taskId);
            if (!task) return;

            document.getElementById('edit-modal-task-id').value = task.id;
            document.getElementById('edit-task-name').value = task.name;
            document.getElementById('edit-task-req').value = task.requirements || '';
            document.getElementById('edit-task-price').value = task.customerPrice;
            document.getElementById('edit-task-expense').value = task.ownerExpense;

            document.getElementById('edit-task-modal').classList.remove('hidden');
        }

        document.getElementById('edit-task-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const taskId = document.getElementById('edit-modal-task-id').value;
            const task = appData.tasks.find(t => t.id == taskId);

            if (task) {
                task.name = document.getElementById('edit-task-name').value;
                task.requirements = document.getElementById('edit-task-req').value;
                task.customerPrice = parseInt(document.getElementById('edit-task-price').value);
                task.ownerExpense = parseInt(document.getElementById('edit-task-expense').value);

                saveData(); // Save to Firestore
                renderAdminUI(); // Update UI
                window.closeEditTaskModal();
            }
        });

        // --- Drag & Drop Handler ---
        function handleTaskSort(taskId, newCatId) {
            const task = appData.tasks.find(t => t.id == taskId);
            if(task && task.categoryId !== newCatId) {
                task.categoryId = newCatId;
                saveData();
            }
        }

        // --- Core Functions ---
        async function saveData() {
            if (!isAdmin) return;
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'noksha_lab', 'main_list');
            try {
                await setDoc(docRef, appData);
            } catch (err) {
                console.error("Save Error:", err);
                showError("‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            }
        }

        window.deleteCategory = function(id) {
            if(!confirm("‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) return;
            appData.categories = appData.categories.filter(c => c.id !== id);
            saveData();
        }

        window.deleteTask = function(id) {
            if(!confirm("‡¶ï‡¶æ‡¶ú‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) return;
            appData.tasks = appData.tasks.filter(t => t.id != id);
            saveData();
        }

        // --- Form Handlers ---
        document.getElementById('add-category-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('new-cat-name').value;
            appData.categories.push({ id: 'cat_' + Date.now(), name: name });
            document.getElementById('new-cat-name').value = '';
            saveData();
        });

        document.getElementById('add-task-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const catId = document.getElementById('task-cat-select').value;
            const name = document.getElementById('task-name').value;
            const req = document.getElementById('task-req').value;
            const price = parseInt(document.getElementById('task-price').value);
            const expense = parseInt(document.getElementById('task-expense').value);

            const newTask = {
                id: Date.now(),
                categoryId: catId,
                name: name,
                requirements: req,
                customerPrice: price,
                ownerExpense: expense
            };
            appData.tasks.push(newTask);
            
            document.getElementById('task-name').value = '';
            document.getElementById('task-req').value = '';
            saveData();
        });

        // --- Auth Functions (Exposed to Window) ---
        window.showLoginModal = () => authModal.classList.remove('hidden');
        window.hideLoginModal = () => authModal.classList.add('hidden');
        window.closeCompleteModal = () => document.getElementById('complete-job-modal').classList.add('hidden');
        window.closeEditTaskModal = () => document.getElementById('edit-task-modal').classList.add('hidden');
        
        window.toggleView = (viewName) => {
            document.getElementById('tab-dashboard').classList.add('hidden');
            document.getElementById('tab-history').classList.add('hidden');
            document.getElementById(`tab-${viewName}`).classList.remove('hidden');
        };

        window.logoutAdmin = () => {
            signOut(auth).then(() => {
                alert("‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü ‡¶∏‡¶´‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá");
                location.reload();
            });
        };

        // Login Logic
        document.getElementById('login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('admin-email').value;
            const pass = document.getElementById('admin-password').value;
            
            signInWithEmailAndPassword(auth, email, pass)
                .then(() => {
                    hideLoginModal();
                })
                .catch((error) => {
                    alert("‡¶≤‡¶ó‡¶ø‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + error.message);
                });
        });

        // View Switchers
        function showAdminPanel() {
            customerView.classList.add('hidden');
            adminView.classList.remove('hidden');
        }
        function showCustomerView() {
            customerView.classList.remove('hidden');
            adminView.classList.add('hidden');
        }

    </script>
</body>
</html>